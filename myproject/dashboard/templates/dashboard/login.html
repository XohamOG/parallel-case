<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-auth.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDFo70_K4d7rywqcXGw3pwY-XnRzwNZxpo",
            authDomain: "template-13d9d.firebaseapp.com",
            projectId: "template-13d9d",
            storageBucket: "template-13d9d.appspot.com",
            messagingSenderId: "1096133946844",
            appId: "1:1096133946844:web:28ecb3ee30addb11d43319",
            measurementId: "G-S38YTKP0VM"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // User signed in
                    const user = userCredential.user;
                    // Send ID token to the server
                    user.getIdToken().then((token) => {
                        fetch("/api/login/", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "Authorization": `Bearer ${token}`
                            }
                        })
                        .then(response => {
                            if (response.ok) {
                                window.location.href = "/person/home/"; // Redirect to home page
                            } else {
                                alert("Login failed!");
                            }
                        });
                    });
                })
                .catch((error) => {
                    alert("Error: " + error.message);
                });
        }
    </script>
</head>
<body>
    <h2>Login</h2>
    <form method="post" onsubmit="event.preventDefault(); login();">
        {% csrf_token %}
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Login</button>
    </form>
</body>
</html>
